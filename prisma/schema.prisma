// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//**Models de Usuário e Autenticação**
model Usuario {
  id                    String            @id @default(uuid())
  nome                  String
  email                 String            @unique
  avatar                String?
  funcao                FuncaoUsuario     @default(Analista)
  senha_hash            String
  criado_em             DateTime          @default(now())
  token_atualizacao     TokenAtualizacao?
  relatorios_criados    Relatorio[]       @relation("Criador_Relatorio")
  relatorios_permitidos Relatorio[]       @relation("Usuarios_Permitidos_Para_Relatorio")

  @@map("usuarios")
}

model TokenAtualizacao {
  id         String   @id @default(uuid())
  expira_em  Int
  usuario_id String   @unique
  usuario    Usuario  @relation(fields: [usuario_id], references: [id])
  criado_em  DateTime @default(now())

  @@map("tokens_atualizacao")
}

enum FuncaoUsuario {
  Admin
  Analista
  Supervisor
  Revisor
}

//**Models de Relatório**
model Relatorio {
  id                             String            @id @default(uuid())
  numero_processo                String            @unique
  natureza_sinistro              Natureza_Sinistro
  cliente                        String
  cnpj                           String
  data_entrada                   DateTime          @default(now())
  data_emissao                   DateTime?
  status                         Status_Relatorio  @default(Formalizando)
  status_recuperacao_carga       String?
  fato_gerador_recuperacao_carga String?
  usuario_responsavel            Usuario           @relation("Criador_Relatorio", fields: [usuario_responsavel_id], references: [id], onDelete: Cascade)
  usuario_responsavel_id         String
  usuarios_permitidos            Usuario[]         @relation("Usuarios_Permitidos_Para_Relatorio")

  formularios_selecionados Tipo_Formulario[]
  formularios              FormulariosDoRelatorio?

  @@map("relatorios")
}

enum Status_Relatorio {
  Formalizando
  Finalizado
  Aprovado
  Rejeitado
  Emitido
}

enum Natureza_Sinistro {
  Roubo
  Furto
  Apreensao
  Outros
}

//**Models de Etapa**
enum Tipo_Formulario {
  form1_Cliente_Segurado
  form2_Caracteristica_Sinistro
  form3_Cronologia_Sinistro
  form4_Do_Carregamento
  form5_Motorista
  form6_Ajudantes
  form7_Veiculo_Transportador
  form8_Orgao_Policial
  form9_Gerenciamento_Risco_Veiculo
  form10_Sistemas_Protecao_Carregamento
  form11_Declaracao_Motorista_Ajudante
  form12_Gerenciamento_Risco_Deposito
  form13_Locais_Evento
  form14_Resumo_Averiguacoes
  form15_Recuperacao_Carga
  form16_Anexos_Fotograficos
  form17_Conclusao
}

enum Status_Formulario {
  Pendente
  Formalizando
  Finalizado
  Aprovado
  Corrigir
  Rejeitado
}

model FormulariosDoRelatorio {
  id              String     @id @default(uuid())
  numero_processo String?    @unique
  relatorio       Relatorio? @relation(fields: [relatorio_id], references: [id], onDelete: Cascade)
  relatorio_id    String     @unique

  form1_Cliente_Segurado                Form1ClienteSegurado?
  form2_Caracteristica_Sinistro         Form2CaracteristicaSinistro?
  form3_Cronologia_Sinistro             Form3CronologiaSinistro?
  form4_Do_Carregamento                 Form4DoCarregamento?
  form5_Motorista                       Form5Motorista?
  form6_Ajudantes                       Form6Ajudantes?
  form7_Veiculo_Transportador           Form7VeiculoTransportador?
  form8_Orgao_Policial                  Form8OrgaoPolicial?
  form9_Gerenciamento_Risco_Veiculo     Form9GerenciamentoRiscoVeiculo?
  form10_Sistemas_Protecao_Carregamento Form10SistemasProtecaoCarregamento?
  form11_Declaracao_Motorista_Ajudante  Form11DeclaracaoMotoristaAjudante?
  form12_Gerenciamento_Risco_Deposito   Form12GerenciamentoRiscoDeposito?
  form13_Locais_Evento                  Form13LocaisEvento?
  form14_Resumo_Averiguacoes            Form14ResumoAveriguacoes?
  form15_Recuperacao_Carga              Form15RecuperacaoCarga?
  form16_Anexos_Fotograficos            Form16AnexosFotograficos?
  form17_Conclusao                      Form17Conclusao?

  @@map("formularios_do_relatorio")
}

model Form1ClienteSegurado {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())
  nome_cliente    String
  cnpj            String
  telefone        String?
  celular         String?
  email           String?
  representante   String?
  cep             String?
  endereco        String?
  numero          String?
  complemento     String?
  bairro          String?
  cidade          String?
  uf              String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String                  @unique

  @@map("form1_Cliente_Segurado")
}

model Form2CaracteristicaSinistro {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  nome_seguradora   String?
  natureza_sinistro Natureza_Sinistro
  carga_embarcada   String?
  valor_carga       String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form2_Caracteristica_Sinistro")
}

model Form3CronologiaSinistro {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  cep_local_sinistro         String?
  endereco_local_sinistro    String?
  numero_local_sinistro      String?
  complemento_local_sinistro String?
  bairro_local_sinistro      String?
  cidade_local_sinistro      String?
  uf_local_sinistro          String?
  comunicante                String?
  data_hora_sinistro         String?
  data_hora_comunicacao      String?
  agente_pamcary             String?
  data_hora_chegada_local    String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form3_Cronologia_Sinistro")
}

model Form4DoCarregamento {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  transportadora      String?
  valor_embarcado     String?
  remetente           String?
  cep_origem          String?
  endereco_origem     String?
  numero_origem       String?
  cidade_origem       String?
  bairro_origem       String?
  uf_origem           String?
  complemento_origem  String?
  destinatario        String?
  cep_destino         String?
  endereco_destino    String?
  numero_destino      String?
  cidade_destino      String?
  bairro_destino      String?
  uf_destino          String?
  complemento_destino String?
  numero_crtc_dacte   String?
  numero_nota_fiscal  String?
  manifesto           String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form4_Do_Carregamento")
}

model Form5Motorista {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  nome_motorista                      String?
  cpf_motorista                       String?
  data_nascimento_motorista           DateTime?
  local_nascimento_motorista          String?
  cnh_motorista                       String?
  tipo_cnh_motorista                  String?
  validade_cnh_motorista              String?
  cep_motorista                       String?
  endereco_motorista                  String?
  numero_motorista                    String?
  complemento_motorista               String?
  bairro_motorista                    String?
  cidade_motorista                    String?
  uf_motorista                        String?
  telefone_motorista                  String?
  celular_motorista                   String?
  email_motorista                     String?
  vinculo_motorista_empresa           String?
  consulta_telerisco_motorista        String?
  numero_consulta_telerisco_motorista String?
  data_consulta_telerisco_motorista   String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form5_Motorista")
}

model Form6Ajudantes {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  nome_ajudante             String?
  cpf_ajudante              String?
  data_nascimento_ajudante  DateTime?
  local_nascimento_ajudante String?
  cnh_ajudante              String?
  tipo_cnh_ajudante         String?
  validade_cnh_ajudante     String?
  cep_ajudante              String?
  endereco_ajudante         String?
  numero_ajudante           String?
  complemento_ajudante      String?
  bairro_ajudante           String?
  cidade_ajudante           String?
  uf_ajudante               String?
  telefone_ajudante         String?
  celular_ajudante          String?
  email_ajudante            String?
  vinculo_ajudante_empresa  String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form6_Ajudantes")
}

model Form7VeiculoTransportador {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  //Cavalo Mecânico
  placa_cavalo_mecanico                 String?
  renavam_cavalo_mecanico               String?
  chassi_cavalo_mecanico                String?
  marca_cavalo_mecanico                 String?
  modelo_cavalo_mecanico                String?
  ano_fabricacao_cavalo_mecanico        String?
  ano_modelo_cavalo_mecanico            String?
  cor_cavalo_mecanico                   String?
  proprietario_cavalo_mecanico          String?
  cpf_cnpj_proprietario_cavalo_mecanico String?
  uf_cavalo_mecanico                    String?

  //Carreta
  placa_carreta                 String?
  renavam_carreta               String?
  chassi_carreta                String?
  marca_carreta                 String?
  modelo_carreta                String?
  ano_fabricacao_carreta        String?
  ano_modelo_carreta            String?
  cor_carreta                   String?
  proprietario_carreta          String?
  cpf_cnpj_proprietario_carreta String?
  uf_carreta                    String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form7_Veiculo_Transportador")
}

model Form8OrgaoPolicial {
  id              String            @id @default(uuid())
  numero_processo String            @unique
  status          Status_Formulario @default(Pendente)
  data_cadastro   DateTime          @default(now())

  delegacia          String?
  endereco_delegacia String?
  numero_delegacia   String?
  bairro_delegacia   String?
  cidade_delegacia   String?
  uf_delegacia       String?
  cep_delegacia      String?
  telefone_delegacia String?
  numero_bo          String?
  data_bo            String?
  numero_ip          String?
  data_ip            String?

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form8_Orgao_Policial")
}

model Form9GerenciamentoRiscoVeiculo {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("9")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form9_Gerenciamento_Risco_Veiculo")
}

model Form10SistemasProtecaoCarregamento {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("10")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form10_Sistemas_Protecao_Carregamento")
}

model Form11DeclaracaoMotoristaAjudante {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("11")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  arquivos_declaracoes Arquivo[]

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form11_Declaracao_Motorista_Ajudante")
}

model Form12GerenciamentoRiscoDeposito {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("12")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form12_Gerenciamento_Risco_Deposito")
}

model Form13LocaisEvento {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("13")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  // Adicione os outros campos específicos deste formulário aqui
  // Exemplo: campo1: TipoDoCampo1
  // campo2: TipoDoCampo2

  foto_local_da_Abordagem Arquivo[]

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form13_Locais_Evento")
}

model Form14ResumoAveriguacoes {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("14")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form14_Resumo_Averiguacoes")
}

model Form15RecuperacaoCarga {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("15")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form15_Recuperacao_Carga")
}

model Form16AnexosFotograficos {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("16")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  arquivos_declaracoes Arquivo[]

  // Adicione os outros campos específicos deste formulário aqui
  // Exemplo: campo1: TipoDoCampo1
  // campo2: TipoDoCampo2

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form16_Anexos_Fotograficos")
}

model Form17Conclusao {
  id              String            @id @default(uuid())
  //numero_etapa    String            @default("17")
  numero_processo String?           @unique
  status          Status_Formulario @default(Pendente)

  // Adicione os outros campos específicos deste formulário aqui
  // Exemplo: campo1: TipoDoCampo1
  // campo2: TipoDoCampo2

  formulario_associado     FormulariosDoRelatorio? @relation(fields: [formularioDoRelatorio_id], references: [id], onDelete: Cascade)
  formularioDoRelatorio_id String?                 @unique

  @@map("form17_Conclusao")
}

//**Model de Arquivo**
model Arquivo {
  id              String  @id @default(uuid())
  nome            String?
  tamanho         Int?
  chave           String
  localizacao     String
  numero_processo String? @unique

  form11_Declaracao_Motorista_Ajudante    Form11DeclaracaoMotoristaAjudante? @relation(fields: [form11_Declaracao_Motorista_Ajudante_id], references: [id], onDelete: Cascade)
  form11_Declaracao_Motorista_Ajudante_id String?
  form13_Locais_Evento                    Form13LocaisEvento?                @relation(fields: [form13_Locais_Evento_id], references: [id], onDelete: Cascade)
  form13_Locais_Evento_id                 String?
  form16_Anexos_Fotograficos              Form16AnexosFotograficos?          @relation(fields: [form16_Anexos_Fotograficos_id], references: [id], onDelete: Cascade)
  form16_Anexos_Fotograficos_id           String?

  @@map("arquivos")
}
